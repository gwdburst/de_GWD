#!/bin/bash
RED='\E[1;31m'
GREEN='\E[1;32m'
YELLOW='\E[1;33m'
BLUE='\E[1;34m'
PURPLE='\E[1;35m'
CYAN='\E[1;36m'
WHITE='\E[1;37m'
cRES='\E[0m'



if [[ -n $(jq -r '.dns.hosts' /opt/de_GWD/0conf 2>/dev/null | grep -v '^null$') ]]; then
echo -e "\r\c" && echo -e "${WHITE}[${cRES}...${WHITE}]\c" && echo -e "\t${WHITE}Collect Hosts${cRES}\c"

jq -r '.dns.hosts | to_entries[] | [.value, .key] | @tsv' /opt/de_GWD/0conf 2>/dev/null | grep -v '^null$' | sed 's/[[:space:]][[:space:]]*/ /g' >/etc/pihole/custom.list

sed -i '/Hosts_START/,/Hosts_END/d' /etc/smartdns/smartdns.conf
echo "# Hosts_START" >>/etc/smartdns/smartdns.conf
cat /etc/pihole/custom.list | while read line; do
  hostDomain=$(echo $line | awk '{print$2}')
  hostIP=$(echo $line | awk '{print$1}')
  sed -i "/address \/$hostDomain\//d" /etc/smartdns/smartdns.conf
  echo "address /$hostDomain/$hostIP" >>/etc/smartdns/smartdns.conf
done
echo "# Hosts_END" >>/etc/smartdns/smartdns.conf

echo -e "\r\c" && echo -e "${WHITE}[ ${GREEN}âœ“ ${WHITE}]\c" && echo -e "\t${WHITE}Collect Hosts${cRES}"
fi
